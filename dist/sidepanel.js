function p(e){try{return new URL(e).hostname.replace("www.","")}catch{return e.startsWith("file://")?e.split("/").slice(-1)[0]:e}}function u(e,t=30){return e.length>t?e.slice(0,t)+"…":e}function m(e,t){if(t.innerHTML="",Object.keys(e).length===0){t.innerHTML+="<p>Немає збережених перевірок.</p>";return}const s=document.createElement("ul");for(const n in e){const r=e[n],i=n.startsWith("http")?p(n):u(n),a=document.createElement("li"),o=document.createElement("button");o.textContent=i,o.style.display="block",o.style.marginBottom="4px";const c=document.createElement("ul");c.style.display="none",r.threats.forEach(l=>{const d=document.createElement("li");d.innerHTML=`<strong>${l.message}</strong><br/><code>${l.html}</code>`,c.appendChild(d)}),o.addEventListener("click",()=>{const l=c.style.display==="block";c.style.display=l?"none":"block"}),a.appendChild(o),a.appendChild(c),s.appendChild(a)}t.appendChild(s)}document.addEventListener("DOMContentLoaded",()=>{var s;const e=document.getElementById("definition-text");if(!e)return;const t=document.createElement("button");t.textContent=" Очистити історію",t.style.marginBottom="10px",t.style.backgroundColor="#f44336",t.style.color="#fff",t.style.border="none",t.style.padding="8px",t.style.borderRadius="4px",t.style.cursor="pointer",t.addEventListener("click",()=>{chrome.storage.local.remove("scanResultsBySite",()=>{e.innerHTML="<p>Історію очищено.</p>"}),chrome.runtime.sendMessage({type:"CLEAR_BADGE"})}),(s=e.parentElement)==null||s.insertBefore(t,e),chrome.storage.local.get("scanResultsBySite",n=>{m(n.scanResultsBySite||{},e)}),chrome.storage.onChanged.addListener((n,r)=>{if(r==="local"&&n.scanResultsBySite){const i=n.scanResultsBySite.newValue||{};m(i,e)}})});
