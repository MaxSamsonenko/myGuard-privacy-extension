chrome.runtime.onMessage.addListener((e,o,a)=>{if(e.type==="SAVE_SCAN_RESULT"){const t=e.payload;chrome.storage.local.get("scanResultsBySite",r=>{const n=r.scanResultsBySite||{};n[t.url]=t,chrome.storage.local.set({scanResultsBySite:n},()=>{console.log("[myGuard] ✅ Scan saved for site:",t.url)})})}if(e.type==="UPDATE_BADGE"){const{threatCount:t}=e.payload||{};chrome.action.setBadgeText({text:t&&t>0?t.toString():""}),chrome.action.setBadgeBackgroundColor({color:"#FF0000"})}return e.type==="CLEAR_BADGE"&&(chrome.action.setBadgeText({text:""}),console.log("[myGuard] ✅ Badge cleared")),!0});chrome.runtime.onInstalled.addListener(()=>{chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}),chrome.storage.local.get("scanResult",e=>{var o;{const a=Array.isArray((o=e.scanResult)==null?void 0:o.threats)?e.scanResult.threats.length:0;chrome.action.setBadgeText({text:a>0?a.toString():""}),chrome.action.setBadgeBackgroundColor({color:"#FF0000"})}})});chrome.action.onClicked.addListener(async e=>{e.id&&(console.log("[myGuard] Sidepanel clicked"),chrome.action.setBadgeText({text:""}),await chrome.sidePanel.setOptions({tabId:e.id,path:"sidepanel.html",enabled:!0}),await chrome.sidePanel.open({tabId:e.id}))});
